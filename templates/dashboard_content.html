{% extends "base.html" %}

{% block content %}

<!-- Only show first page on page ready -->
<script>
  $(document).ready(function() {
    $("div#attacking_goals_page_1").removeClass("hidden")
    $("div#attacking_assists_page_1").removeClass("hidden")
    $("div#attacking_shots_on_page_1").removeClass("hidden")
    $("div#creation_passes_key_page_1").removeClass("hidden")
    $("div#creation_dribbles_succeeded_page_1").removeClass("hidden")
    $("div#creation_passes_page_1").removeClass("hidden")
    $("div#defending_tackles_page_1").removeClass("hidden")
    $("div#defending_interceptions_page_1").removeClass("hidden")
    $("div#defending_blocks_page_1").removeClass("hidden")
    $("div#other_rating_page_1").removeClass("hidden")
    $("div#other_goals_conceded_page_1").removeClass("hidden")
    $("div#other_penalties_saved_page_1").removeClass("hidden")
  });
</script>

<!-- Change page -->
<script>
  function changePage(idPrefix, pageNo) {
    var i = 1;
    for (; i < 6; i++) {
      if (i == pageNo) {
        $("div#" + idPrefix + i.toString()).removeClass("hidden");
      } else {
        $("div#" + idPrefix + i.toString()).addClass("hidden");
      }
    }
  }
</script>

{% set section_names = {"goals": "Goals","assists": "Assists","shots_on": "Shots On Target","passes_key": "Key Passes","dribbles_succeeded": "Successful Dribbles","passes": "Passes","tackles": "Tackles","interceptions": "Interceptions","blocks": "Blocks","rating": "Player Rating","goals_conceded": "Avg Goals Conceded","penalties_saved": "Penalties Saved"} %}

<!-- Per 90 Button -->
<div style="text-align: center; padding-bottom: 15px; padding-top: 15px">
  {% if per_90 == True %}
    <button class="btn btn-dark btn-sm" onclick="location.href = location.href.split('per-90')[0]">
      Overall Stats
    </button>
  {% else %}
    <button class="btn btn-dark btn-sm" onclick="location.href = location.href.split('per-90')[0] + 'per-90'">
      Per 90 Minutes Stats
    </button>
  {%endif%}
</div>

{% for stat in query_result.keys() %}
  <div style="padding-bottom: 30px">
    <h4 class="display-6">{{stat.capitalize()}} Statistics</h4>
    <hr class="my-4">
    <div class="row">
    {% for substat in query_result.get(stat).keys() %}
      <div class="card col-xs-4 col-sm-4 col-md-4" style="width: 18rem; font-size: x-small;">
        <div class="card-body">
          <h5 class="card-title" style="text-align: center">{{section_names.get(substat)}}</h5>
          <!-- Card Contents -->
          <ul class="list-group list-group-flush">
            {% set pagemod = query_result.get(stat).get(substat)|length % 10 %}
            {% set pagediv = query_result.get(stat).get(substat)|length // 10 %}
            {% set num_pages = pagediv + 1 if pagemod > 0 else pagediv %} 
            {% for page in range(1, num_pages + 1) %}
              <div id="{{stat}}_{{substat}}_page_{{page}}" class="hidden">
              {% for row in (query_result.get(stat).get(substat)[10 * (page - 1) : 10 * page]) %}
              <li class="list-group-item">
                <div class="row h-100 justify-content-center align-items-center">
                  <div class="col-3 text-center float-left">
                    <img src={{row.get("team_logo")}} height="30px"/>
                  </div>
                  <div class="col-6 text-left float-center">
                    <div class="row">
                      <strong>{{row.get("rank")}}. {{row.get("name")}}</strong>
                    </div>
                    <div class="row">
                      {{row.get("team_name")}}
                    </div>
                  </div>
                  <div class="col-3 text-center float-right">
                    <strong>{{row.get("stat")}}</strong>
                  </div>
                </div>
              </li>
              {% endfor %}
              </div>
            {% endfor %}
            <li class="list-group-item">
              <div class="row h-100">
                <div class="col-12">
                  <nav class="nav justify-content-center">
                    <ul class="pagination pagination-md">
                      {% for i in range(1, num_pages + 1) %}
                        <li class="page-item" style="color: blue">
                          <a class="page-link" onclick="changePage('{{stat}}_{{substat}}_page_', {{i}})">{{i}}</a>
                        </li>
                      {% endfor %}
                    </ul>
                  </nav>
                </div>
              </div>
            </li>
          </ul>
          <!-- End Card Contents -->
        </div>
      </div>
    {% endfor %}
    </div>
  </div>
{% endfor %}

{% endblock %}

